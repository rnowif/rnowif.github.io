<!DOCTYPE html><html lang="en-ca"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-127790305-1"></script><script>window.dataLayer = window.dataLayer || [];
		  function gtag(){dataLayer.push(arguments);}
		  gtag('js', new Date());

		  gtag('config', 'UA-127790305-1');</script><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Purposeful Testing or Why the Test Pyramid is a Scam - A Software Gardener</title><meta name="description" content="The test pyramid is a metaphor that illustrates the “ideal” weight of tests depending on their granularity. It goes from the unit tests at the base - which are more numerous - to the end-to-end tests at the top - which should be scarce. It&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://rnowif.github.io/purposeful-testing-or-why-the-test-pyramid-is-a-scam.html"><link rel="alternate" type="application/atom+xml" href="https://rnowif.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://rnowif.github.io/feed.json"><meta property="og:title" content="Purposeful Testing or Why the Test Pyramid is a Scam"><meta property="og:image" content="https://rnowif.github.io/media/posts/12/anthony-mcgee-iOZOydyIw3M-unsplash.jpg"><meta property="og:site_name" content="A Software Gardener"><meta property="og:description" content="The test pyramid is a metaphor that illustrates the “ideal” weight of tests depending on their granularity. It goes from the unit tests at the base - which are more numerous - to the end-to-end tests at the top - which should be scarce. It&hellip;"><meta property="og:url" content="https://rnowif.github.io/purposeful-testing-or-why-the-test-pyramid-is-a-scam.html"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@rnowif"><meta name="twitter:title" content="Purposeful Testing or Why the Test Pyramid is a Scam"><meta name="twitter:description" content="The test pyramid is a metaphor that illustrates the “ideal” weight of tests depending on their granularity. It goes from the unit tests at the base - which are more numerous - to the end-to-end tests at the top - which should be scarce. It&hellip;"><meta name="twitter:image" content="https://rnowif.github.io/media/posts/12/anthony-mcgee-iOZOydyIw3M-unsplash.jpg"><style>:root{--body-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--heading-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--logo-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--menu-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}</style><link rel="stylesheet" href="https://rnowif.github.io/assets/css/style.css?v=1d9126d5c592483966037cf187b30969"><link rel="stylesheet" href="https://rnowif.github.io/assets/css/prism.css?v=a9de1acca9c12df6ea0d5f1bf5f5f4c7"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://rnowif.github.io/purposeful-testing-or-why-the-test-pyramid-is-a-scam.html"},"headline":"Purposeful Testing or Why the Test Pyramid is a Scam","datePublished":"2021-01-14T08:25","dateModified":"2021-01-16T08:13","image":{"@type":"ImageObject","url":"https://rnowif.github.io/media/posts/12/anthony-mcgee-iOZOydyIw3M-unsplash.jpg","height":3468,"width":5133},"description":"The test pyramid is a metaphor that illustrates the “ideal” weight of tests depending on their granularity. It goes from the unit tests at the base - which are more numerous - to the end-to-end tests at the top - which should be scarce. It&hellip;","author":{"@type":"Person","name":"Renaud Humbert-Labeaumaz"},"publisher":{"@type":"Organization","name":"Renaud Humbert-Labeaumaz"}}</script></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://rnowif.github.io/">A Software Gardener</a></header><main><article class="post"><div class="hero"><figure class="hero__image hero__image--overlay"><img src="https://rnowif.github.io/media/posts/12/anthony-mcgee-iOZOydyIw3M-unsplash.jpg" srcset="https://rnowif.github.io/media/posts/12/responsive/anthony-mcgee-iOZOydyIw3M-unsplash-xs.jpg 300w, https://rnowif.github.io/media/posts/12/responsive/anthony-mcgee-iOZOydyIw3M-unsplash-sm.jpg 480w, https://rnowif.github.io/media/posts/12/responsive/anthony-mcgee-iOZOydyIw3M-unsplash-md.jpg 768w, https://rnowif.github.io/media/posts/12/responsive/anthony-mcgee-iOZOydyIw3M-unsplash-lg.jpg 1024w, https://rnowif.github.io/media/posts/12/responsive/anthony-mcgee-iOZOydyIw3M-unsplash-xl.jpg 1360w, https://rnowif.github.io/media/posts/12/responsive/anthony-mcgee-iOZOydyIw3M-unsplash-2xl.jpg 1600w" sizes="(max-width: 1600px) 100vw, 1600px" loading="eager" height="3468" width="5133" alt=""><figcaption>https://unsplash.com/@tmg</figcaption></figure><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2021-01-14T08:25">January 14, 2021</time></div><h1>Purposeful Testing or Why the Test Pyramid is a Scam</h1><div class="post__meta post__meta--author"><img src="https://rnowif.github.io/media/website/renaud.png" loading="eager" alt="Renaud Humbert-Labeaumaz" class="post__author-thumb"> <a href="https://rnowif.github.io/authors/renaud-humbert-labeaumaz/" class="feed__author invert">Renaud Humbert-Labeaumaz</a></div></div></header></div><div class="wrapper post__entry"><p>The <a href="https://martinfowler.com/articles/practical-test-pyramid.html">test pyramid</a> is a metaphor that illustrates the “ideal” weight of tests depending on their granularity. It goes from the unit tests at the base - which are more numerous - to the end-to-end tests at the top - which should be scarce.</p><p>It is often opposed to the “ice cream cone” <a href="https://abstracta.us/blog/test-automation/best-testing-practices-agile-teams-automation-pyramid/">anti-pattern</a> that features a few unit tests and a massive amount of manual end-to-end tests.</p><p>I think that this pattern is a good heuristic - especially when your test suite looks like an ice cream cone - but it also yields a lot of sterile discussions, such as</p><ul><li>What is a unit test? What is an integration test?</li><li>Do I test private methods?</li><li>Do I test pass-through methods? Do I test getters, setters?</li><li>What is ideal code coverage? Should I go to jail if I have less than 100% coverage?</li></ul><h2 id="purposeful-testing">Purposeful Testing</h2><p>Behind this click-bait title, I would like to go <em>beyond</em> the test pyramid and start reasoning in terms of <em>purpose</em> rather than <em>form</em>. Whenever I write tests, I make sure to ask myself the following questions, to be sure that my tests are fit-for-purpose:</p><ul><li><strong>What is the purpose of this test?</strong> <em>Knowing what the test is supposed to check prevents me from trying to test too much and ultimately write something that will hurt me in the long run. Let’s remember that tests are similar to production code in the way that they require maintenance.</em></li><li><strong>What would make this test fail?</strong> <em>By trying to answer this question, I often realise that this test’s failure does not mean that it has achieved its purpose. Worse, sometimes the test simply cannot fail. Tests are not supposed to check everything, they should keep passing when something that they are not supposed to cover is broken.</em></li><li><strong>Will it impede our ability to refactor?</strong> <em>A test can too heavily be coupled with the production code can actually be counterproductive. Indeed, it would incentivise not to refactor and hurt maintainability. A typical symptom of a test that impedes refactoring is the overuse of mocks.</em></li></ul><h2 id="test-taxonomy">Test Taxonomy</h2><p>By applying this reasoning, I identified the following types of test (this list is far from complete and will get updated in the future).</p><h3 id="support-tests">Support Tests</h3><p>These tests aim to <em>support</em> the development of an algorithm or standalone class (i.e. no dependency). You would typically start with a very straightforward code and incrementally add test cases to increase the scope and add new edge cases. I have found this type of test to be the perfect use case for <a href="https://www.youtube.com/watch?v=RWYvBNX9wcU">Test Driven Development</a>.</p><h3 id="plumbing-tests">Plumbing Tests</h3><p><em>Plumbing</em> tests ensure that several classes, external libraries, or third-party services work together as intended. In the test pyramid, these tests fall into the generally accepted definition of <em>integration tests</em>. The goal here is not to check all the edge cases but rather the assumptions made about the various APIs.</p><h3 id="use-case-tests">Use Case Tests</h3><p>These end-to-end tests make sure that a user scenario works as intended. <em>Use case tests</em> typically include roundtrips to the database and virtually no mocks. They are good candidates for <a href="https://www.youtube.com/watch?v=Qe84jbwyZ3U&amp;t=47s">double-loop TDD</a>.</p><h3 id="orchestration-tests">Orchestration Tests</h3><p>Unless use case tests, <em>orchestration</em> tests rely heavily on mocks. They are relevant for pieces of code that will just enforce a workflow and call other dependencies. For instance, you may want to check that the code triggers a method call when some conditions are met. I usually make sure to keep these tests are extremely lean as too many mocks can seriously impede refactoring.</p><h3 id="developer-experience-dx-tests">Developer Experience (DX) Tests</h3><p>As I always say to everyone willing to listen to me, tests do not only check your code’s behaviour, but also its design and usability. <em>DX</em> tests are extremely valuable when you are creating an API and want to verify that its usage makes sense and is straightforward. These tests should treat the API as a black box and make absolutely no assumptions about its internal behaviour.</p><h3 id="crutch-tests">Crutch Tests</h3><p>The <em>crutch</em> tests are particularly useful when you want to tackle messy legacy code and refactor it. The objective is to extract a chunk of code, test it from the outside and rewrite it entirely without touching the tests at all. We can readily notice that these tests will typically include roundtrips to the database. The main challenge of these tests is to find <a href="https://biratkirat.medium.com/working-effectively-with-legacy-code-changing-software-part-1-chapter-4-b997b78fc0a2">seams</a> to separate the code you want to rewrite from the rest. These seams are a good place to put mocks in place and inject data in the system under test. Once the refactoring is over, some of these tests might become redundant and can be removed.</p><h3 id="confidence-tests">Confidence Tests</h3><p>We often read that we should not test third-party libraries because they are already massively tested and it’s not our place to do it. While this may be true, I think it can be useful to test our <em>assumptions</em> about the libraries we use. The <em>confidence</em> tests make sure you understand how an external library works an ensure that it won’t change its behaviour under you (e.g. during an upgrade). By the way, these tests can also apply to your own legacy code!</p><h3 id="documentation-tests">Documentation Tests</h3><p>We should always thrive to write the simplest code possible. However, it is sometimes not possible and we have to slip some hacky hacks into the codebase (e.g. optimisations, libraries or language shortcomings, etc.). In this case, I like to write <em>documentation</em> tests that will explain the code’s behaviour so that other developers (or me, in a week) can understand what it does.</p><h3 id="scratch-tests">Scratch Tests</h3><p><em>Scratch</em> tests are short-lived tests that I sometimes use to check an assumption I have about the code. I use these tests to ask the code questions and see what is its answer. I typically delete them as soon as my assumption is verified or discarded.</p><h2 id="takeaways">Takeaways</h2><p>For years, I struggled with the granularity of my tests because I had the feeling to write some tests for the sake of it. Also, I was refraining myself from writing other tests that would have been useful, because they did not fit in any of the boxes that the test pyramid provides.</p><p>When I started to step aside this test pyramid, I realised that I did not care that much about the number of tests or the balance between unit, integration and end-to-end tests. I just write them when I feel that they could bring something to the table.</p><p>Also, I noticed that I am using way less mocks than I used to because I don’t force myself to write “pure” unit tests anymore. As a consequence, I feel that tests enable refactoring instead of impeding it.</p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on January 16, 2021</p><ul class="post__tag"><li><a href="https://rnowif.github.io/tags/testing/">testing</a></li></ul><div class="post__share"><a href="https://twitter.com/share?url=https%3A%2F%2Frnowif.github.io%2Fpurposeful-testing-or-why-the-test-pyramid-is-a-scam.html&amp;via=%40rnowif&amp;text=Purposeful%20Testing%20or%20Why%20the%20Test%20Pyramid%20is%20a%20Scam" class="js-share twitter" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://rnowif.github.io/assets/svg/svg-map.svg#twitter"/></svg> <span>Twitter</span> </a><a href="http://www.linkedin.com/shareArticle?url=https%3A%2F%2Frnowif.github.io%2Fpurposeful-testing-or-why-the-test-pyramid-is-a-scam.html&amp;title=Purposeful%20Testing%20or%20Why%20the%20Test%20Pyramid%20is%20a%20Scam" class="js-share linkedin" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://rnowif.github.io/assets/svg/svg-map.svg#linkedin"/></svg> <span>LinkedIn</span></a></div><div class="post__bio bio"><img class="bio__avatar" src="https://rnowif.github.io/media/website/renaud.png" loading="lazy" alt="Renaud Humbert-Labeaumaz"><div class="bio__info"><h3 class="bio__name"><a href="https://rnowif.github.io/authors/renaud-humbert-labeaumaz/" class="invert" rel="author">Renaud Humbert-Labeaumaz</a></h3></div></div></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-prev"><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://rnowif.github.io/assets/svg/svg-map.svg#arrow-prev"/></svg> <a href="https://rnowif.github.io/the-blind-golden-master.html" class="invert post__nav-link" rel="prev"><span>Previous</span> The Blind Golden Master</a></div><div class="post__nav-next"><a href="https://rnowif.github.io/rehabilitating-the-liskov-substitution-principle.html" class="invert post__nav-link" rel="next"><span>Next</span> In Defence of the Liskov Substitution Principle </a><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://rnowif.github.io/assets/svg/svg-map.svg#arrow-next"/></svg></div></div></nav><div class="post__comments"><div class="wrapper"><h2 class="h5">Comments</h2><div id="disqus_thread"></div><script>var disqus_config = function () {
                       this.page.url = 'https://rnowif.github.io/purposeful-testing-or-why-the-test-pyramid-is-a-scam.html';
               		this.page.identifier = '12';
                   };
               
                   var disqus_loaded = false;
               
                   function publiiLoadDisqus() {
                       if(disqus_loaded) {
                           return false;
                       }
               
                       var top = document.getElementById('disqus_thread').offsetTop;
               
                       if (!disqus_loaded && (window.scrollY || window.pageYOffset) + window.innerHeight > top) {
                           disqus_loaded = true;
               
                           (function () {
                               var d = document, s = d.createElement('script');
                               s.src = 'https://'+'rnowif'.trim()+'.disqus.com/embed.js';
                               s.setAttribute('data-timestamp', +new Date());
                               (d.head || d.body).appendChild(s);
                           })();
                       }
                   }
               
                   publiiLoadDisqus();
               
                   window.onscroll = function() {
                       publiiLoadDisqus();
                   };</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" target="_blank" rel="nofollow noopener noreferrer">comments powered by Disqus.</a></noscript></div></div></main><footer class="footer"><div class="footer__social"><a href="https://twitter.com/rnowif" aria-label="Twitter"><svg><use xlink:href="https://rnowif.github.io/assets/svg/svg-map.svg#twitter"/></svg></a></div><div class="footer__copyright"><p>Renaud Humbert-Labeaumaz - 2021</p></div><button class="footer__bttop js-footer__bttop" aria-label="Back to top"><svg><title>Back to top</title><use xlink:href="https://rnowif.github.io/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.top',
   };</script><script defer="defer" src="https://rnowif.github.io/assets/js/scripts.min.js?v=f4c4d35432d0e17d212f2fae4e0f8247"></script><script>var images = document.querySelectorAll('img[loading]');

        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script><script defer="defer" src="https://rnowif.github.io/assets/js/prism.js?v=8a3c962ef789bf5cc575d02e6a4bd4b2"></script></body></html>