<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
  <meta charset="utf-8">
  <title>The Blind Golden Master - Renaud Humbert-Labeaumaz</title>
  <meta name="author" content="Renaud Humbert-Labeaumaz">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="https://rnowif.github.io/blog/2020/05/01/the-blind-golden-master/">
  <link href="/favicon.png" type="image/png" rel="icon">
  <link href="/atom.xml" rel="alternate" title="Renaud Humbert-Labeaumaz" type="application/atom+xml">

  <!-- http://opengraphprotocol.org/ -->
  <meta name="twitter:card" content="summary_large_image">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://rnowif.github.io/blog/2020/05/01/the-blind-golden-master/">
  <meta property="og:title" content="The Blind Golden Master - Renaud Humbert-Labeaumaz">
  

  <script src="/javascripts/libs/jquery/jquery-2.1.3.min.js"></script>

<link href="/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">

<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">


  
  <link href="/stylesheets/screen.css" media="screen, projection, print" rel="stylesheet" type="text/css">

  
   <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-127790305-1', 'auto');
    ga('send', 'pageview');

  </script>


</head>

  <body   >
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="wrap">
      
        <header role="banner">
          <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" title="toggle navbar" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Renaud Humbert-Labeaumaz</a>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li ><a href="/blog/archives">Archives</a></li>

            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="/atom.xml" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="navbar-form navbar-right" action="https://www.google.com/search" method="GET">
                    <input type="hidden" name="sitesearch" value="rnowif.github.io">
                    <div class="form-group">
                        <input class="form-control" type="text" name="q" placeholder="Search">
                    </div>
                </form>
            
        </div>
    </div>
</nav>


        </header>
      
      <div id="main" role="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content" itemscope itemtype="http://schema.org/Blog">
    <meta itemprop="name" content="Renaud Humbert-Labeaumaz" />
    
    <meta itemprop="url" content="https://rnowif.github.io" />
    <article class="hentry" role="article" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
      
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2020-05-01T17:46:38-04:00"  data-updated="true" itemprop="datePublished dateCreated">Fri  1 May 2020,  5:46 PM</time>
        
      </p>
    
    
    <h1 class="entry-title" itemprop="name headline">
        The Blind Golden Master
        
    </h1>
    
  </header>


<div class="entry-content clearfix" itemprop="articleBody description"><p>As part of my work, I regularly have to refactor/rewrite some part of our system that has little test coverage, if any. Most of the time, the code is too big or complex to write a test suite comprehensive enough to give me the confidence I need in a timely manner. Consequently, I have come to use a characterisation test technique that I called the &ldquo;Blind Golden Master&rdquo;.</p>

<!-- more -->


<h2>Characterisation Tests</h2>

<p>If you know what a characterisation test is, you can skip this section. If not, bear with me for a moment. A characterisation test aims to check that an already existing piece of code always keeps <strong>the same behaviour</strong> throughout the changes you make. This behaviour does not need to be correct - if there is a bug in the code, these tests will check that it is still here at the end! Characterisation tests are then extremely useful during refactoring efforts since it is not necessary to understand (or even read) the code to write them.</p>

<p>One of the most usual characterisation test techniques is the Golden Master. The idea is to exercise the code and record its output somehow (e.g. in a file). Then, the test will exercise the code with the same input and check the output against the previously recorded one - the golden master. See <a href="https://rnowif.github.io/blog/2017/04/10/trivia-refactoring/">here</a> for an example of this technique.</p>

<h2>The Blind Golden Master</h2>

<p>Sometimes, it is impractical to store the output of the code - or we simply couldn&rsquo;t be bothered to do it. Sometimes, the new implementation and the legacy one have to co-exist (and evolve) for a while and the only goal is to check that they always both behave the same.</p>

<p>With this technique, the test simply call both the new and the legacy code and assert that their output are identical. This approach is extremely effective when the method has a limited set of parameters and no side effect.</p>

<p>For instance, I used it to change the template engine for our codebase (C#).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="kt">string</span> <span class="n">newResult</span> <span class="p">=</span> <span class="n">_newEngine</span><span class="p">.</span><span class="n">Render</span><span class="p">(</span><span class="n">templateName</span><span class="p">,</span> <span class="n">model</span><span class="p">);</span>
</span><span class='line'><span class="kt">string</span> <span class="n">legacyResult</span> <span class="p">=</span> <span class="n">_legacyEngine</span><span class="p">.</span><span class="n">Render</span><span class="p">(</span><span class="n">templateName</span><span class="p">,</span> <span class="n">model</span><span class="p">);</span>
</span><span class='line'><span class="n">Minify</span><span class="p">(</span><span class="n">newResult</span><span class="p">).</span><span class="n">Should</span><span class="p">().</span><span class="n">BeEquivalentTo</span><span class="p">(</span><span class="n">Minify</span><span class="p">(</span><span class="n">legacyResult</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<p>I also used it to change an algorithm that determine the file extension of a document (see the Java codebase <a href="https://github.com/rnowif/refactoring-with-tests/tree/refacto/socrates">here</a>).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">FileExtension</span> <span class="n">legacyValue</span> <span class="o">=</span> <span class="n">application</span><span class="o">.</span><span class="na">getExtension</span><span class="o">(</span><span class="n">country</span><span class="o">,</span> <span class="n">region</span><span class="o">);</span>
</span><span class='line'><span class="n">FileExtension</span> <span class="n">newValue</span> <span class="o">=</span> <span class="n">application</span><span class="o">.</span><span class="na">getExtensionV2</span><span class="o">(</span><span class="n">country</span><span class="o">,</span> <span class="n">region</span><span class="o">);</span>
</span><span class='line'><span class="n">assertEquals</span><span class="o">(</span><span class="n">legacyValue</span><span class="o">,</span> <span class="n">newValue</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>If the algorithm is crucial to the application and there are a lot of potential combinations to test, it is even possible to run the test in production: every time the code is called, it can invoke both the algorithms, compare their output and raise an error if they don&rsquo;t match, and always return the legacy result. When there is no more error, it is time to switch to the new implementation. This <a href="https://github.blog/2015-12-15-move-fast/">article</a> explains how GitHub rewrote its merge algorithm using this technique.</p>

<h2>Conclusion</h2>

<p>The Blind Golden Master is an extremely simple technique that provides confidence during refactoring without having to spend hours writing tests for the legacy code. It is a powerful enabler for improvement that does not require any specific tooling or overhead. Since I started using it a few years ago, it has proven a precious addition to my testing toolbox.</p>
</div>


      <footer class="post-footer">
        <p class="meta text-muted">
          
  



<figure class="author-image">
    <span class="img" href="/about" style="background-image: url(/images/renaud.png)"><span class="hidden">Picture</span></span>
</figure>

<section class="author">
    <h4><span class="byline author vcard" itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="fn" itemprop="name">Renaud Humbert-Labeaumaz</span></span></h4>

    <a class="fa fa-link" href="https://rnowif.github.io">
        <span class="hidden">https://rnowif.github.io</span>
    </a>
    <a class="fa fa-twitter" href="https://twitter.com/rnowif">
        <span class="hidden">rnowif</span>
    </a>
    <a class="fa fa-github" href="https://github.com/rnowif">
        <span class="hidden">rnowif</span>
    </a>
</section>

<hr>

<section class="share">
    
    <h4>Share this post</h4>
    
    <a class="fa fa-twitter" href="https://twitter.com/intent/tweet?url=https://rnowif.github.io/blog/2020/05/01/the-blind-golden-master/;"
        onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <span class="hidden">Twitter</span>
    </a>
    <a class="fa fa-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://rnowif.github.io/blog/2020/05/01/the-blind-golden-master/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <span class="hidden">Facebook</span>
    </a>
    <a class="fa fa-google-plus" href="https://plus.google.com/share?url=https://rnowif.github.io/blog/2020/05/01/the-blind-golden-master/" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
    </a>
    
</section>




<!--
<footer class="post-footer">


            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="https://twitter.com/intent/tweet?text=Instant%20Movie%20Streamer%20v3%20Release&amp;url=http://iyask.me/instant-movie-streamer-v3-release/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://iyask.me/instant-movie-streamer-v3-release/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://iyask.me/instant-movie-streamer-v3-release/" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>


        </footer>


-->

          












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2020-05-01T17:46:38-04:00"  data-updated="true" itemprop="datePublished dateCreated">Fri  1 May 2020,  5:46 PM</time>
          <br>

<span class="glyphicon glyphicon-tags"></span>&nbsp;
<span class="categories">
  
    <a class='category' href='/blog/categories/refactoring/'>refactoring</a>, <a class='category' href='/blog/categories/test/'>test</a>
  
</span>


        </p>
        
          <div class="pager">
            
            
              
                <a href="/blog/2018/10/22/asp-dot-net-clean-architecture/" class="col-xs-12 col-md-4 btn btn-default" title="Previous Post: ASP.Net Clean Architecture"> 
                  <div class="text-muted">
                    <small>Previous Post</small>
                  </div>
                  <div class="pager-title">
                    <h4>ASP.Net Clean Architecture</h4>
                  </div>
                </a>
              
            
            
            
          </div>
        
      </footer>
    </article>
    
      <section>
        <h2>Comments</h2>
        <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
      </section>
    
  </div>
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2020 - Renaud Humbert-Labeaumaz<br>
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/bhrigu123/abacus">abacus theme</a></span>.
  </small>
</p>

</div>
</footer>
    

<script type="text/javascript">
      var disqus_shortname = 'rnowif';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'https://rnowif.github.io/blog/2020/05/01/the-blind-golden-master/';
        var disqus_url = 'https://rnowif.github.io/blog/2020/05/01/the-blind-golden-master/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


<script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr.js"></script>


  </body>
</html>
