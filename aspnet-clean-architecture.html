<!DOCTYPE html><html lang="en-ca"><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-127790305-1"></script><script>window.dataLayer = window.dataLayer || [];
		  function gtag(){dataLayer.push(arguments);}
		  gtag('js', new Date());

		  gtag('config', 'UA-127790305-1');</script><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>ASP.Net Clean Architecture - A Software Gardener</title><meta name="description" content="When creating a new project, it is always a challenge to design a clean, coherent and modular architecture. There are guidelines out there to help us achieve this goal but the implementation is not always straightforward. In this blog post, I will propose an implementation&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://rnowif.github.io/aspnet-clean-architecture.html"><link rel="alternate" type="application/atom+xml" href="https://rnowif.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://rnowif.github.io/feed.json"><meta property="og:title" content="ASP.Net Clean Architecture"><meta property="og:image" content="https://rnowif.github.io/media/posts/2/architecture-3357028_1920.jpg"><meta property="og:site_name" content="A Software Gardener"><meta property="og:description" content="When creating a new project, it is always a challenge to design a clean, coherent and modular architecture. There are guidelines out there to help us achieve this goal but the implementation is not always straightforward. In this blog post, I will propose an implementation&hellip;"><meta property="og:url" content="https://rnowif.github.io/aspnet-clean-architecture.html"><meta property="og:type" content="article"><style>:root{--body-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--heading-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--logo-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--menu-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}</style><link rel="stylesheet" href="https://rnowif.github.io/assets/css/style.css?v=1d9126d5c592483966037cf187b30969"><link rel="stylesheet" href="https://rnowif.github.io/assets/css/prism.css?v=a9de1acca9c12df6ea0d5f1bf5f5f4c7"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://rnowif.github.io/aspnet-clean-architecture.html"},"headline":"ASP.Net Clean Architecture","datePublished":"2018-10-22T10:04","dateModified":"2021-01-11T09:22","image":{"@type":"ImageObject","url":"https://rnowif.github.io/media/posts/2/architecture-3357028_1920.jpg","height":1008,"width":1920},"description":"When creating a new project, it is always a challenge to design a clean, coherent and modular architecture. There are guidelines out there to help us achieve this goal but the implementation is not always straightforward. In this blog post, I will propose an implementation&hellip;","author":{"@type":"Person","name":"Renaud Humbert-Labeaumaz"},"publisher":{"@type":"Organization","name":"Renaud Humbert-Labeaumaz"}}</script></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://rnowif.github.io/">A Software Gardener</a></header><main><article class="post"><div class="hero"><figure class="hero__image hero__image--overlay"><img src="https://rnowif.github.io/media/posts/2/architecture-3357028_1920.jpg" srcset="https://rnowif.github.io/media/posts/2/responsive/architecture-3357028_1920-xs.jpg 300w, https://rnowif.github.io/media/posts/2/responsive/architecture-3357028_1920-sm.jpg 480w, https://rnowif.github.io/media/posts/2/responsive/architecture-3357028_1920-md.jpg 768w, https://rnowif.github.io/media/posts/2/responsive/architecture-3357028_1920-lg.jpg 1024w, https://rnowif.github.io/media/posts/2/responsive/architecture-3357028_1920-xl.jpg 1360w, https://rnowif.github.io/media/posts/2/responsive/architecture-3357028_1920-2xl.jpg 1600w" sizes="(max-width: 1600px) 100vw, 1600px" loading="eager" height="1008" width="1920" alt=""><figcaption>https://pixabay.com/users/piro4d-2707530</figcaption></figure><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2018-10-22T10:04">October 22, 2018</time></div><h1>ASP.Net Clean Architecture</h1><div class="post__meta post__meta--author"><img src="https://rnowif.github.io/media/website/renaud.png" loading="eager" alt="Renaud Humbert-Labeaumaz" class="post__author-thumb"> <a href="https://rnowif.github.io/authors/renaud-humbert-labeaumaz/" class="feed__author invert">Renaud Humbert-Labeaumaz</a></div></div></header></div><div class="wrapper post__entry"><p>When creating a new project, it is always a challenge to design a clean, coherent and modular architecture. There are guidelines out there to help us achieve this goal but the implementation is not always straightforward. In this blog post, I will propose an implementation of the Uncle Bob’s <a href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html">Clean Architecture</a> on an ASP.Net project. The source code of this project can be found on my <a href="https://github.com/rnowif/Expenses">GitHub</a>.</p><p>The main idea of the clean architecture is to reduce the coupling between the core business code and the external world (Web, Database, Frameworks). In order to do that, the project can be divided in 3 main modules, that will be described below: <code>Domain</code>, <code>Web</code> and <code>Data</code>.</p><h2 id="domain">Domain</h2><p>This module contains all the core business code. It does not depend on anything else than the .NET SDK and contains sub-modules.</p><h3 id="entities"><code>Entities</code></h3><p>They are the building blocks of the domain and encapsulate the business concepts. Entities are not coupled with any ORM framework. Indeed the domain model can be quite different from the database model!</p><h3 id="use-cases"><code>Use Cases</code></h3><p>Following the Uncle Bob’s definition, they contains application specific business rules and orchestrate the flow of data to and from the entities and implement higher level business rules.</p><p>It is important to understand that the domain model should not leak outside of this module. In order to do that, use cases should not take entities are arguments for their methods, but a list of raw arguments. For instance, the use case that submit a new expense looks like the following:</p><pre><code class="language-csharp">public interface ISubmitExpense
{
    void Execute(Guid userId, string description, long priceWithoutTax, long priceIncludingTax);
}</code></pre><p>It is responsible to build an <code>Expense</code> object and apply the relevant business logic.</p><h3 id="repositories"><code>Repositories</code></h3><p>In the domain module, repositories are only interfaces that are used by the use cases to access data without any knowledge of the concrete implementations: data can be retrieved from databases, files or external Web APIs, it should not affect the core business logic at all. To reinforce this, repositories take entities as arguments and return entities as well. It is the responsibility of the concrete implementation to handle conversion if needed.</p><h2 id="data">Data</h2><p>The data module contains the database and ORM configuration and the repositories implementations. Typically, we find the EntityFramework configuration in this module as well as the annotated classes that will be mapped with database entries. Repositories implementation are responsible for converting “database objects” in domain objects:</p><pre><code class="language-csharp">public void Create(Expense expense)
{
  // Convert the domain object &quot;Expense&quot; into a database object &quot;DbExpense&quot;
  _dbContext.Expenses.Add(DbExpense.FromExpense(expense));
  _dbContext.SaveChanges();
}</code></pre><p>This prevents the ORM framework to leak into the domain.</p><h2 id="web">Web</h2><p>The web module contains all the controllers. It is responsible for handling HTTP requests, converting JSON or XML payloads to objects and invoking use cases:</p><pre><code class="language-csharp">[HttpPost]
public void SubmitExpense([FromBody] SubmitExpenseCommand expense)
{
  // The controller just invoke the use case with data extracted from the body of the HTTP request
  _submitExpense.Execute(expense.UserId, expense.Description, expense.PriceWithoutTax, expense.PriceIncludingTax);
}</code></pre><p>It should not contain any business logic whatsoever. As a consequence, controllers are very lightweight and easy to test.</p><h2 id="dependency-injection">Dependency injection</h2><p>In order to achieve low coupling between the modules, interfaces are injected into the constructor of the different classes:</p><pre><code class="language-csharp">public class SubmitExpense : ISubmitExpense
{

    private readonly IExpenseRepository _repository;

    public SubmitExpense(IExpenseRepository repository)
    {
      _repository = repository;
    }
}</code></pre><p>The plumbing is handled by the <code>Startup.cs</code> class where all the implementations of the interfaces are declared:</p><pre><code class="language-csharp">public void ConfigureServices(IServiceCollection services)
{
  // ...

  // Register &quot;SubmitExpense&quot; as the implementation of &quot;ISubmitExpense&quot;
  services.AddTransient&lt;ISubmitExpense, SubmitExpense&gt;();
  services.AddTransient&lt;IExpenseRepository, ExpenseRepository&gt;();
}</code></pre><h2 id="conclusion">Conclusion</h2><p>In this architecture, the emphasis is put on the domain. Every other modules should adapt to it but it does not depend on anything. This results in lightweight classes that are very easy to understand and test in isolation.<br>Moreover, the low coupling makes it very easy to change the infrastructure. Indeed, the domain module would not change a bit if we decided to have a CLI instead of a Web App or if the data should be retrieved from an external Web API instead of a PostgreSQL database.</p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on January 11, 2021</p><ul class="post__tag"><li><a href="https://rnowif.github.io/tags/architecture/">architecture</a></li><li><a href="https://rnowif.github.io/tags/csharp/">csharp</a></li></ul><div class="post__share"><a href="https://twitter.com/share?url=https%3A%2F%2Frnowif.github.io%2Faspnet-clean-architecture.html&amp;via=%40rnowif&amp;text=ASP.Net%20Clean%20Architecture" class="js-share twitter" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://rnowif.github.io/assets/svg/svg-map.svg#twitter"/></svg> <span>Twitter</span> </a><a href="http://www.linkedin.com/shareArticle?url=https%3A%2F%2Frnowif.github.io%2Faspnet-clean-architecture.html&amp;title=ASP.Net%20Clean%20Architecture" class="js-share linkedin" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://rnowif.github.io/assets/svg/svg-map.svg#linkedin"/></svg> <span>LinkedIn</span></a></div><div class="post__bio bio"><img class="bio__avatar" src="https://rnowif.github.io/media/website/renaud.png" loading="lazy" alt="Renaud Humbert-Labeaumaz"><div class="bio__info"><h3 class="bio__name"><a href="https://rnowif.github.io/authors/renaud-humbert-labeaumaz/" class="invert" rel="author">Renaud Humbert-Labeaumaz</a></h3></div></div></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-prev"><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://rnowif.github.io/assets/svg/svg-map.svg#arrow-prev"/></svg> <a href="https://rnowif.github.io/c-for-the-java-developer-enums.html" class="invert post__nav-link" rel="prev"><span>Previous</span> C# for the Java Developer: Enums</a></div><div class="post__nav-next"><a href="https://rnowif.github.io/the-blind-golden-master.html" class="invert post__nav-link" rel="next"><span>Next</span> The Blind Golden Master </a><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://rnowif.github.io/assets/svg/svg-map.svg#arrow-next"/></svg></div></div></nav><div class="post__comments"><div class="wrapper"><h2 class="h5">Comments</h2><div id="disqus_thread"></div><script>var disqus_config = function () {
                       this.page.url = 'https://rnowif.github.io/aspnet-clean-architecture.html';
               		this.page.identifier = '2';
                   };
               
                   var disqus_loaded = false;
               
                   function publiiLoadDisqus() {
                       if(disqus_loaded) {
                           return false;
                       }
               
                       var top = document.getElementById('disqus_thread').offsetTop;
               
                       if (!disqus_loaded && (window.scrollY || window.pageYOffset) + window.innerHeight > top) {
                           disqus_loaded = true;
               
                           (function () {
                               var d = document, s = d.createElement('script');
                               s.src = 'https://'+'rnowif'.trim()+'.disqus.com/embed.js';
                               s.setAttribute('data-timestamp', +new Date());
                               (d.head || d.body).appendChild(s);
                           })();
                       }
                   }
               
                   publiiLoadDisqus();
               
                   window.onscroll = function() {
                       publiiLoadDisqus();
                   };</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" target="_blank" rel="nofollow noopener noreferrer">comments powered by Disqus.</a></noscript></div></div></main><footer class="footer"><div class="footer__social"><a href="https://twitter.com/rnowif" aria-label="Twitter"><svg><use xlink:href="https://rnowif.github.io/assets/svg/svg-map.svg#twitter"/></svg></a></div><div class="footer__copyright"><p>Renaud Humbert-Labeaumaz - 2021</p></div><button class="footer__bttop js-footer__bttop" aria-label="Back to top"><svg><title>Back to top</title><use xlink:href="https://rnowif.github.io/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.top',
   };</script><script defer="defer" src="https://rnowif.github.io/assets/js/scripts.min.js?v=f4c4d35432d0e17d212f2fae4e0f8247"></script><script>var images = document.querySelectorAll('img[loading]');

        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script><script defer="defer" src="https://rnowif.github.io/assets/js/prism.js?v=8a3c962ef789bf5cc575d02e6a4bd4b2"></script></body></html>